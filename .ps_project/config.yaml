# .ps_project/config.yaml:

version: 2

workflows:
  experiment-workflow:
    steps:
      -
        name: "rigl-mnist-grad-accumulation-1"
        command: experiment.run_single_node
        params:
          name: rigl-mnist-cli-config-yaml
          command: python train_mnist_rigl.py
          container: pytorch/pytorch:latest
          experimentEnv:
            DENSE_ALLOCATION: 0.1
            STATIC_TOPO: 0
            DELTA: 100
            ALPHA: 0.3
            GRAD_ACCUMULATION_N: 1
            EPOCHS: 14
            LR: 1.0
            GAMMA: 0.7
            BATCH_SIZE: 64
            EVAL_BATCH_SIZE: 1000
          machineType: P4000
          modelPath: /artifacts
          modelType: PyTorch
        # checks: #[optional]
        #   onnx:loss:
        #     target: "0.0..0.5"
        #     aggregate: "mean"
        #   defaults: #[optional]
        #     precision: 3
      triggers:
        branches:
          only: paperspace
          # ignore: irrelevant-branch
        # tags:
          # only:
            # - v.*
            # - latest
#   param-file-experiment-workflow:
#     steps:
#       -
#         name: "param-file-experiment"
#         command: experiment.run_single_node
#         paramsFile: .ps_project/param-file-experiment.yml
#         checks: #[optional]
#           custom:loss:
#             target: "0.0..0.5"
#             aggregate: "/mean/0"
#       triggers:
#         branches:
#           only: master
